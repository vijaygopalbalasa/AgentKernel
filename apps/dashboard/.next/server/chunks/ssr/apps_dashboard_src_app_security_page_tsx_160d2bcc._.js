module.exports=[43445,a=>{"use strict";var b=a.i(69580),c=a.i(89930),d=a.i(16098),e=a.i(43203),f=a.i(10173),g=a.i(92146),h=a.i(78534),i=a.i(1732);function j(a){if(!a||"object"!=typeof a)return"No evidence";let b=Object.keys(a);return b.length?`Evidence: ${b.slice(0,3).join(", ")}${b.length>3?"...":""}`:"No evidence"}function k({policies:a,cases:d,sanctions:e,appeals:k,onOpenCase:l,onResolveCase:m,onApplySanction:n,onLiftSanction:o,onOpenAppeal:p,onResolveAppeal:q}){let[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)("warning"),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(""),T=async a=>{a.preventDefault(),r.trim()&&(await l(r.trim(),t.trim()||void 0,v.trim()||void 0),s(""),u(""),w(""))},U=async a=>{a.preventDefault(),x.trim()&&(await n(x.trim(),z),y(""))},V=async a=>{a.preventDefault(),B.trim()&&(await m(B.trim(),D.trim()||void 0,F.trim()||void 0),C(""),E(""),G(""))},W=async a=>{a.preventDefault(),H.trim()&&(await o(H.trim()),I(""))},X=async a=>{a.preventDefault(),J.trim()&&(await p(J.trim(),L.trim()||void 0),K(""),M(""))},Y=async a=>{a.preventDefault(),N.trim()&&(await q(N.trim(),P.trim()||void 0,R.trim()||void 0),O(""),Q(""),S(""))};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-xs font-mono font-semibold text-ctp-subtext0 uppercase tracking-wider mb-3",children:"Policies"}),0===a.length?(0,b.jsx)(i.EmptyState,{message:"No policies"}):(0,b.jsx)("div",{className:"space-y-2",children:a.map(a=>(0,b.jsxs)("div",{className:"os-panel px-3 py-2 flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-sm font-medium text-ctp-text",children:a.name}),(0,b.jsx)(f.Tag,{variant:"active"===a.status?"success":"default",className:"ml-2",children:a.status||"active"})]}),(0,b.jsx)("span",{className:"text-2xs text-ctp-overlay0",children:a.id})]},a.id))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-xs font-mono font-semibold text-ctp-subtext0 uppercase tracking-wider mb-3",children:"Moderation Cases"}),0===d.length?(0,b.jsx)(i.EmptyState,{message:"No cases"}):(0,b.jsx)("div",{className:"space-y-2",children:d.map(a=>(0,b.jsxs)("div",{className:"os-panel px-3 py-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-ctp-text",children:a.id}),(0,b.jsx)(f.Tag,{variant:"open"===a.status?"warning":"default",children:a.status})]}),(0,b.jsxs)("div",{className:"text-2xs text-ctp-overlay0 mt-1",children:[a.reason||"No reason"," | ",j(a.evidence)]})]},a.id))}),(0,b.jsxs)("form",{onSubmit:T,className:"mt-3 flex gap-2 items-end",children:[(0,b.jsx)(g.Input,{label:"Subject Agent",value:r,onChange:a=>s(a.target.value),placeholder:"agent-id"}),(0,b.jsx)(g.Input,{label:"Policy ID",value:t,onChange:a=>u(a.target.value),placeholder:"optional"}),(0,b.jsx)(g.Input,{label:"Reason",value:v,onChange:a=>w(a.target.value),placeholder:"optional"}),(0,b.jsx)(h.Button,{type:"submit",disabled:!r.trim(),children:"Open Case"})]}),(0,b.jsxs)("form",{onSubmit:V,className:"mt-2 flex gap-2 items-end",children:[(0,b.jsx)(g.Input,{label:"Case ID",value:B,onChange:a=>C(a.target.value),placeholder:"case-id"}),(0,b.jsx)(g.Input,{label:"Status",value:D,onChange:a=>E(a.target.value),placeholder:"resolved"}),(0,b.jsx)(g.Input,{label:"Notes",value:F,onChange:a=>G(a.target.value),placeholder:"optional"}),(0,b.jsx)(h.Button,{type:"submit",variant:"ghost",disabled:!B.trim(),children:"Resolve"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-xs font-mono font-semibold text-ctp-subtext0 uppercase tracking-wider mb-3",children:"Sanctions"}),0===e.length?(0,b.jsx)(i.EmptyState,{message:"No sanctions"}):(0,b.jsx)("div",{className:"space-y-2",children:e.map(a=>(0,b.jsxs)("div",{className:"os-panel px-3 py-2 flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-sm text-ctp-text",children:a.type}),(0,b.jsx)("span",{className:"text-2xs text-ctp-overlay0 ml-2",children:a.subject_agent_id||"—"})]}),(0,b.jsx)("span",{className:"text-2xs text-ctp-overlay0",children:a.id})]},a.id))}),(0,b.jsxs)("form",{onSubmit:U,className:"mt-3 flex gap-2 items-end",children:[(0,b.jsx)(g.Input,{label:"Subject Agent",value:x,onChange:a=>y(a.target.value),placeholder:"agent-id"}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)("label",{className:"text-xs text-ctp-subtext0 font-medium",children:"Type"}),(0,b.jsxs)("select",{value:z,onChange:a=>A(a.target.value),className:"bg-ctp-surface0 border border-ctp-surface1 rounded-input px-3 py-2 text-sm text-ctp-text",children:[(0,b.jsx)("option",{value:"warning",className:"bg-ctp-mantle",children:"Warning"}),(0,b.jsx)("option",{value:"quarantine",className:"bg-ctp-mantle",children:"Quarantine"}),(0,b.jsx)("option",{value:"suspension",className:"bg-ctp-mantle",children:"Suspension"}),(0,b.jsx)("option",{value:"ban",className:"bg-ctp-mantle",children:"Ban"})]})]}),(0,b.jsx)(h.Button,{type:"submit",disabled:!x.trim(),children:"Apply"})]}),(0,b.jsxs)("form",{onSubmit:W,className:"mt-2 flex gap-2 items-end",children:[(0,b.jsx)(g.Input,{label:"Sanction ID",value:H,onChange:a=>I(a.target.value),placeholder:"sanction-id"}),(0,b.jsx)(h.Button,{type:"submit",variant:"ghost",disabled:!H.trim(),children:"Lift"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-xs font-mono font-semibold text-ctp-subtext0 uppercase tracking-wider mb-3",children:"Appeals"}),0===k.length?(0,b.jsx)(i.EmptyState,{message:"No appeals"}):(0,b.jsx)("div",{className:"space-y-2",children:k.map(a=>(0,b.jsxs)("div",{className:"os-panel px-3 py-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm text-ctp-text",children:a.id}),(0,b.jsx)(f.Tag,{variant:"open"===a.status?"warning":"default",children:a.status})]}),(0,b.jsxs)("div",{className:"text-2xs text-ctp-overlay0 mt-1",children:[a.resolution||"No resolution"," | ",j(a.evidence)]})]},a.id))}),(0,b.jsxs)("form",{onSubmit:X,className:"mt-3 flex gap-2 items-end",children:[(0,b.jsx)(g.Input,{label:"Case ID",value:J,onChange:a=>K(a.target.value),placeholder:"case-id"}),(0,b.jsx)(g.Input,{label:"Reason",value:L,onChange:a=>M(a.target.value),placeholder:"optional"}),(0,b.jsx)(h.Button,{type:"submit",disabled:!J.trim(),children:"Open Appeal"})]}),(0,b.jsxs)("form",{onSubmit:Y,className:"mt-2 flex gap-2 items-end",children:[(0,b.jsx)(g.Input,{label:"Appeal ID",value:N,onChange:a=>O(a.target.value),placeholder:"appeal-id"}),(0,b.jsx)(g.Input,{label:"Status",value:P,onChange:a=>Q(a.target.value),placeholder:"resolved"}),(0,b.jsx)(g.Input,{label:"Notes",value:R,onChange:a=>S(a.target.value),placeholder:"optional"}),(0,b.jsx)(h.Button,{type:"submit",variant:"ghost",disabled:!N.trim(),children:"Resolve"})]})]})]})}function l({entries:a,loading:d,onQuery:e}){let[f,j]=(0,c.useState)(""),[k,l]=(0,c.useState)(""),[m,n]=(0,c.useState)("50");return(0,b.jsxs)("div",{children:[(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),e({action:f.trim()||void 0,actorId:k.trim()||void 0,limit:Number(m)||50})},className:"flex gap-2 items-end mb-4",children:[(0,b.jsx)(g.Input,{label:"Action",value:f,onChange:a=>j(a.target.value),placeholder:"filter by action"}),(0,b.jsx)(g.Input,{label:"Actor ID",value:k,onChange:a=>l(a.target.value),placeholder:"filter by actor"}),(0,b.jsx)("div",{className:"w-20",children:(0,b.jsx)(g.Input,{label:"Limit",type:"number",value:m,onChange:a=>n(a.target.value)})}),(0,b.jsx)(h.Button,{type:"submit",disabled:d,children:d?"Loading...":"Query"})]}),0===a.length?(0,b.jsx)(i.EmptyState,{message:"No audit entries"}):(0,b.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:a.map((a,c)=>(0,b.jsxs)("div",{className:"os-panel px-3 py-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-ctp-text",children:a.action}),(0,b.jsx)("span",{className:"text-2xs text-ctp-overlay0",children:new Date(a.created_at).toLocaleString()})]}),(0,b.jsxs)("div",{className:"text-2xs text-ctp-overlay0 mt-0.5",children:["Actor: ",a.actor_id||"—"," | Resource: ",a.resource_type||"—"," | Outcome: ",a.outcome]})]},a.id||c))})]})}function m({tokens:a,loading:d,onList:e,onGrant:f,onRevoke:j,onRevokeAll:k}){let[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(""),v=async a=>{if(a.preventDefault(),!l.trim()||!n.trim())return;let b=n.split(/[\n,]/).map(a=>a.trim()).filter(Boolean),c=Number(r);await f(l.trim(),b,p.trim()||void 0,c>0?c:void 0),o(""),q(""),s("")},w=async a=>{a.preventDefault(),t.trim()&&(await j(t.trim()),u(""))},x=async()=>{l.trim()&&await k(l.trim())};return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex gap-2 items-end mb-4",children:[(0,b.jsx)(g.Input,{label:"Agent ID",value:l,onChange:a=>m(a.target.value),placeholder:"agent-id"}),(0,b.jsx)(h.Button,{onClick:()=>e(l.trim()||void 0),disabled:d,children:d?"Loading...":"List Tokens"}),(0,b.jsx)(h.Button,{variant:"danger",onClick:x,disabled:!l.trim(),children:"Revoke All"})]}),0===a.length?(0,b.jsx)(i.EmptyState,{message:"No capability tokens"}):(0,b.jsx)("div",{className:"space-y-2 mb-6 max-h-64 overflow-y-auto",children:a.map(a=>(0,b.jsxs)("div",{className:"os-panel px-3 py-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-ctp-text",children:a.id}),(0,b.jsx)(h.Button,{variant:"ghost",onClick:()=>j(a.id),className:"text-xs",children:"Revoke"})]}),(0,b.jsxs)("div",{className:"text-2xs text-ctp-overlay0 mt-0.5",children:["Agent: ",a.agentId," | Expires: ",a.expiresAt?new Date(a.expiresAt).toLocaleString():"—"]}),(0,b.jsx)("div",{className:"text-2xs text-ctp-overlay0 mt-0.5",children:Array.isArray(a.permissions)?a.permissions.map(a=>`${a.category}.${a.actions?.join("|")||"*"}${a.resource?`:${a.resource}`:""}`).join(", "):"—"})]},a.id))}),(0,b.jsxs)("div",{className:"border-t border-ctp-surface0 pt-4 mt-4",children:[(0,b.jsx)("h4",{className:"text-xs font-mono text-ctp-subtext0 uppercase mb-3",children:"Grant Token"}),(0,b.jsxs)("form",{onSubmit:v,className:"space-y-2",children:[(0,b.jsx)(g.Input,{label:"Permissions (comma-separated)",value:n,onChange:a=>o(a.target.value),placeholder:"memory.read, llm.execute"}),(0,b.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,b.jsx)(g.Input,{label:"Purpose",value:p,onChange:a=>q(a.target.value),placeholder:"optional"}),(0,b.jsx)("div",{className:"w-40",children:(0,b.jsx)(g.Input,{label:"Duration (ms)",type:"number",value:r,onChange:a=>s(a.target.value),placeholder:"optional"})}),(0,b.jsx)(h.Button,{type:"submit",disabled:!l.trim()||!n.trim(),children:"Grant"})]})]})]}),(0,b.jsxs)("div",{className:"border-t border-ctp-surface0 pt-4 mt-4",children:[(0,b.jsx)("h4",{className:"text-xs font-mono text-ctp-subtext0 uppercase mb-3",children:"Revoke by ID"}),(0,b.jsxs)("form",{onSubmit:w,className:"flex gap-2 items-end",children:[(0,b.jsx)(g.Input,{label:"Token ID",value:t,onChange:a=>u(a.target.value),placeholder:"token-id"}),(0,b.jsx)(h.Button,{type:"submit",variant:"danger",disabled:!t.trim(),children:"Revoke"})]})]})]})}var n=a.i(36146);function o(){let{sendAgentTask:a,operatorAgentId:d}=(0,n.useWebSocket)(),[e,f]=(0,c.useState)("Global Lockdown"),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(!1),m=async b=>{if(!d)throw Error("Set operator agent first");return a(d,b)},o=async a=>{let b=await m({type:"policy_list",limit:100});return b?.policies?.find(b=>b.name===a)},p=async a=>{let b=await o(a);if(b)return b;let c=await m({type:"policy_create",name:a,description:"Global incident lockdown policy",rules:{rules:[{type:"deny",action:"tool.invoked",resourceType:"tool",reason:"Incident lockdown active",sanction:{type:"quarantine"}}]}});return c?.policy},q=async()=>{l(!0),j(null);try{let a=await p(e.trim()||"Global Lockdown");a?.id&&(await m({type:"policy_set_status",policyId:a.id,status:"active"}),j(`Lockdown enabled (${a.id})`))}catch(a){j(`Error: ${a instanceof Error?a.message:"Failed"}`)}finally{l(!1)}},r=async()=>{l(!0),j(null);try{let a=await o(e.trim()||"Global Lockdown");if(!a?.id)return void j("No policy found");await m({type:"policy_set_status",policyId:a.id,status:"inactive"}),j(`Lockdown disabled (${a.id})`)}catch(a){j(`Error: ${a instanceof Error?a.message:"Failed"}`)}finally{l(!1)}};return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex gap-2 items-end mb-4",children:[(0,b.jsx)(g.Input,{label:"Policy Name",value:e,onChange:a=>f(a.target.value),placeholder:"Global Lockdown"}),(0,b.jsx)(h.Button,{onClick:q,disabled:k,children:k?"Working...":"Enable Lockdown"}),(0,b.jsx)(h.Button,{variant:"ghost",onClick:r,disabled:k,children:"Disable Lockdown"})]}),i&&(0,b.jsx)("div",{className:`text-xs font-mono ${i.startsWith("Error")?"text-ctp-red":"text-ctp-green"}`,children:i})]})}function p(){let[a,f]=(0,c.useState)("audit"),{status:g,operatorAgentId:h}=(0,n.useWebSocket)(),i=function(){let{sendAgentTask:a,operatorAgentId:b}=(0,n.useWebSocket)(),[d,e]=(0,c.useState)({policies:[],cases:[],sanctions:[],appeals:[]}),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(null),j=(0,c.useCallback)(async c=>{if(!b)throw Error("Set operator agent first");return a(b,c)},[a,b]),k=(0,c.useCallback)(async()=>{if(b){g(!0),i(null);try{let[a,b,c,d]=await Promise.all([j({type:"policy_list",limit:50}),j({type:"moderation_case_list",limit:50}),j({type:"sanction_list",limit:50}),j({type:"appeal_list",limit:50})]);e({policies:a?.policies??[],cases:b?.cases??[],sanctions:c?.sanctions??[],appeals:d?.appeals??[]})}catch(a){i(a instanceof Error?a.message:"Failed to fetch")}finally{g(!1)}}},[j,b]),l=(0,c.useCallback)(async(a,b,c)=>{await j({type:"moderation_case_open",subjectAgentId:a,...b&&{policyId:b},...c&&{reason:c}}),await k()},[j,k]),m=(0,c.useCallback)(async(a,b,c)=>{await j({type:"moderation_case_resolve",caseId:a,...b&&{status:b},...c&&{resolution:c}}),await k()},[j,k]),o=(0,c.useCallback)(async(a,b)=>{await j({type:"sanction_apply",subjectAgentId:a,sanctionType:b}),await k()},[j,k]),p=(0,c.useCallback)(async a=>{await j({type:"sanction_lift",sanctionId:a}),await k()},[j,k]),q=(0,c.useCallback)(async(a,b)=>{await j({type:"appeal_open",caseId:a,...b&&{reason:b}}),await k()},[j,k]),r=(0,c.useCallback)(async(a,b,c)=>{await j({type:"appeal_resolve",appealId:a,...b&&{status:b},...c&&{resolution:c}}),await k()},[j,k]);return{...d,loading:f,error:h,refresh:k,openCase:l,resolveCase:m,applySanction:o,liftSanction:p,openAppeal:q,resolveAppeal:r}}(),j=function(){let{sendAgentTask:a,operatorAgentId:b}=(0,n.useWebSocket)(),[d,e]=(0,c.useState)([]),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(null);return{entries:d,loading:f,error:h,query:(0,c.useCallback)(async c=>{if(!b)return void i("Set operator agent first");g(!0),i(null);try{let d=await a(b,{type:"audit_query",...c?.action&&{action:c.action},...c?.actorId&&{actorId:c.actorId},limit:c?.limit||50});e(d?.entries??[])}catch(a){i(a instanceof Error?a.message:"Audit query failed")}finally{g(!1)}},[a,b])}}(),p=function(){let{sendAgentTask:a,operatorAgentId:b}=(0,n.useWebSocket)(),[d,e]=(0,c.useState)([]),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(null),j=(0,c.useCallback)(async c=>{if(!b)throw Error("Set operator agent first");return a(b,c)},[a,b]),k=(0,c.useCallback)(async a=>{g(!0),i(null);try{let c=await j({type:"capability_list",agentId:a||b});e(c?.tokens??[])}catch(a){i(a instanceof Error?a.message:"Failed to list tokens")}finally{g(!1)}},[j,b]),l=(0,c.useCallback)(async(a,b,c,d)=>{await j({type:"capability_grant",agentId:a,permissions:b,...c&&{purpose:c},...d&&{durationMs:d}}),await k(a)},[j,k]),m=(0,c.useCallback)(async a=>{await j({type:"capability_revoke",tokenId:a}),await k()},[j,k]),o=(0,c.useCallback)(async a=>{await j({type:"capability_revoke_all",agentId:a}),await k(a)},[j,k]);return{tokens:d,loading:f,error:h,listTokens:k,grant:l,revoke:m,revokeAll:o}}();return(0,c.useEffect)(()=>{"connected"===g&&h&&i.refresh()},[g,h]),(0,b.jsxs)(d.Window,{title:"Security Center",icon:(0,b.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:(0,b.jsx)("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})}),className:"h-full",children:[!h&&(0,b.jsx)("div",{className:"mb-4 px-3 py-2 bg-ctp-yellow/10 border border-ctp-yellow/20 rounded-panel text-xs text-ctp-yellow font-mono",children:"Set an operator agent in Preferences to use security features."}),(0,b.jsx)("div",{className:"flex gap-1 mb-4 p-1 bg-ctp-crust rounded-panel w-fit",children:[{id:"audit",label:"Audit Log"},{id:"governance",label:"Governance",preview:!0},{id:"capabilities",label:"Capabilities",preview:!0},{id:"incident",label:"Incident",preview:!0}].map(c=>(0,b.jsxs)("button",{onClick:()=>f(c.id),className:`px-3 py-1.5 text-xs font-mono rounded-input transition-colors ${a===c.id?"bg-ctp-blue/15 text-ctp-blue font-medium":"text-ctp-overlay0 hover:text-ctp-subtext1"}`,children:[c.label,c.preview&&(0,b.jsx)("span",{className:"ml-1.5 text-2xs px-1 py-0.5 rounded bg-ctp-surface1 text-ctp-overlay0",children:"Preview"})]},c.id))}),(0,b.jsxs)(e.Panel,{children:["governance"===a&&(0,b.jsx)(k,{policies:i.policies,cases:i.cases,sanctions:i.sanctions,appeals:i.appeals,onOpenCase:i.openCase,onResolveCase:i.resolveCase,onApplySanction:i.applySanction,onLiftSanction:i.liftSanction,onOpenAppeal:i.openAppeal,onResolveAppeal:i.resolveAppeal}),"audit"===a&&(0,b.jsx)(l,{entries:j.entries,loading:j.loading,onQuery:j.query}),"capabilities"===a&&(0,b.jsx)(m,{tokens:p.tokens,loading:p.loading,onList:p.listTokens,onGrant:p.grant,onRevoke:p.revoke,onRevokeAll:p.revokeAll}),"incident"===a&&(0,b.jsx)(o,{}),i.error&&(0,b.jsx)("div",{className:"mt-3 text-xs text-ctp-red font-mono",children:i.error})]})]})}a.s(["default",()=>p],43445)}];

//# sourceMappingURL=apps_dashboard_src_app_security_page_tsx_160d2bcc._.js.map