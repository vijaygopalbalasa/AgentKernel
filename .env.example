# ═══════════════════════════════════════════════════════════════
# AgentKernel — Configuration
# Copy to .env and fill in your values: cp .env.example .env
# Or run: agentkernel init (generates secure random secrets)
# ═══════════════════════════════════════════════════════════════

# Runtime environment (affects defaults and validation)
NODE_ENV=development

# ─── LLM PROVIDERS ────────────────────────────────────────────
# Add at least one provider. Multiple providers enable automatic failover.

# Anthropic (Claude) — Primary recommended provider
ANTHROPIC_API_KEY=sk-ant-...

# OpenAI (GPT) — Also enables embedding-based vector search (text-embedding-3-small)
# Required for semantic memory search in Qdrant. Text search works without it.
OPENAI_API_KEY=sk-...

# Google (Gemini)
GOOGLE_AI_API_KEY=...

# Ollama (Local models — free, no API key needed)
OLLAMA_URL=http://localhost:11434

# ─── INFRASTRUCTURE ───────────────────────────────────────────
# Connection URLs for PostgreSQL, Redis, and Qdrant.
# These defaults match docker-compose.yml credentials out of the box.
# For local development without Docker, adjust host/port/credentials.

DATABASE_URL=postgresql://agentuser:agentpass@localhost:5432/agentdb
REDIS_URL=redis://localhost:6379
QDRANT_URL=http://localhost:6333

# ─── GATEWAY ──────────────────────────────────────────────────

GATEWAY_PORT=18800
GATEWAY_AUTH_TOKEN=change-me-to-a-random-secret
INTERNAL_AUTH_TOKEN=change-me-to-an-internal-secret
GATEWAY_MAX_PAYLOAD_BYTES=10485760
GATEWAY_MAX_CONNECTIONS=500
GATEWAY_MESSAGE_RATE_LIMIT=600
MONITOR_AGENT_INTERVAL_MS=60000

# ─── SECURITY & PERMISSIONS ──────────────────────────────────
# PERMISSION_SECRET signs capability tokens (HMAC-SHA256).
# Use a long random string. agentkernel init generates one for you.

PERMISSION_SECRET=change-me-to-a-long-secret
PERMISSION_TOKEN_DURATION_MS=2592000000

# Agent manifest signing (recommended for production)
MANIFEST_SIGNING_SECRET=
REQUIRE_MANIFEST_SIGNATURE=true

# Enforce strict hardening in production (will exit if unmet)
# ENFORCE_PRODUCTION_HARDENING=false

# ─── AGENT RUNTIME ────────────────────────────────────────────

MAX_AGENT_ERRORS=5
MAX_AGENT_RESTARTS=3
AGENT_WORKER_HEARTBEAT_TIMEOUT_MS=30000
AGENT_WORKER_RUNTIME=local
MAX_AGENT_TASK_TIMEOUT_MS=60000
# AGENT_WORKER_PATH=/absolute/path/to/agent-worker.js

# Docker isolation (for production)
# AGENT_WORKER_RUNTIME=docker
# AGENT_WORKER_IMAGE=agentkernel-worker:latest
# AGENT_WORKER_DOCKER_NETWORK=
# AGENT_WORKER_DOCKER_READONLY=true
# AGENT_WORKER_DOCKER_TMPFS=/tmp:rw,size=64m,/var/tmp:rw,size=64m
# AGENT_WORKER_DOCKER_CAP_DROP=ALL
# AGENT_WORKER_DOCKER_NO_NEW_PRIVS=true
# AGENT_WORKER_DOCKER_SECCOMP_PROFILE=
# AGENT_WORKER_DOCKER_PIDS_LIMIT=128
# AGENT_WORKER_DOCKER_STORAGE_OPTS=size=2G

# ─── SANDBOXING / ACCESS CONTROL ─────────────────────────────

ALLOWED_PATHS=/tmp/agentkernel
ALLOWED_DOMAINS=example.com,*.example.com
ALLOWED_COMMANDS=git,rg,ls,cat,echo
ALLOW_ALL_PATHS=false
ALLOW_ALL_DOMAINS=false
ALLOW_ALL_COMMANDS=false
MAX_MEMORY_PER_AGENT_MB=512

# Optional egress proxy for network tools
# AGENT_EGRESS_PROXY_URL=http://egress-proxy:3128
# ENFORCE_EGRESS_PROXY=true
# EGRESS_ALLOWED_DOMAINS=example.com,*.example.com

# ─── MEMORY & RETENTION ──────────────────────────────────────

AUDIT_LOG_RETENTION_DAYS=365
EVENTS_RETENTION_DAYS=90
TASK_MESSAGES_RETENTION_DAYS=90
EPISODIC_RETENTION_DAYS=365
SEMANTIC_RETENTION_DAYS=365
PROCEDURAL_RETENTION_DAYS=365

# Memory encryption (optional, at-rest)
# MEMORY_ENCRYPTION_ENABLED=false
# MEMORY_ENCRYPTION_KEY=
# NOTE: When encryption is enabled, vector embeddings are not stored/searchable.

# Memory archival and tiering (optional)
# EPISODIC_ARCHIVE_DAYS=30
# SEMANTIC_ARCHIVE_DAYS=90
# PROCEDURAL_ARCHIVE_DAYS=90
# MEMORY_ARCHIVE_RETENTION_DAYS=365

# Storage requirements
REQUIRE_PERSISTENT_STORE=true
REQUIRE_VECTOR_STORE=false

# ─── STREAMING ────────────────────────────────────────────────
# CHAT_STREAM_CHUNK_SIZE=120

# ─── MCP SERVERS ──────────────────────────────────────────────
# JSON array of MCP server configurations for tool access
# MCP_SERVERS=[{"name":"filesystem","transport":"stdio","command":"node","args":["/path/to/server.js"],"allowedTools":["read*","write*"],"blockedTools":["admin:*"]}]

# ─── CLUSTER / HA ─────────────────────────────────────────────
# CLUSTER_MODE=false
# CLUSTER_NODE_ID=
# CLUSTER_NODE_WS_URL=
# CLUSTER_NODE_HOST=
# CLUSTER_NODE_PORT=
# CLUSTER_NODE_HEARTBEAT_MS=10000
# CLUSTER_FORWARD_TIMEOUT_MS=15000
# DISTRIBUTED_SCHEDULER=false

# ─── OBSERVABILITY ────────────────────────────────────────────

LOG_LEVEL=info
TRACING_ENABLED=false
TRACING_SAMPLE_RATE=1
TRACING_EXPORTER_URL=
